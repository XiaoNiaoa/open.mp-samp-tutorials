# 代码执行效率测试
源于[SA-MP论坛原帖](https://sampforum.blast.hk/showthread.php?tid=218491) 作者：Slice，Nero_3D

Slice：
```
每天我都能看到人们用新的错误方式来基准测试他们的代码，所以我觉得制定某种
标准以便于与其他基准测试结果进行比较是个好主意。
我最近修改了我的基准测试宏，并在其中添加了一个 "热身 "功能，以获得尽可能
高的精度。
```
### 为什么要进行基准测试？
主要是为了确保您的代码不会对服务器造成任何性能问题。

### 注意
 - 尽量将所有代码都放在基准函数内；也可在宏之间声明变量等。
 - 仅用于测试--它会冻结服务器几秒钟（取决于测试时间）。
 - 不要做任何可能影响基准测试结果的事情（音乐、视频、进入游戏等）。

### 说明
测试的结果意味着代码在一毫秒内可以运行多少次。这给了你一个很好的视角！

首先，任何执行次数超过 1 次/毫秒的代码都不会有问题。当玩家较多时，或代码被频繁使用时，它可能会让服务器运行得很辛苦。

如果你要创建可供他人使用的函数，请尽量将其保持在 50 次/毫秒以上。

对于回调中使用的大段代码或类似代码，我建议将其保持在 20 次/毫秒以上。

# 使用方法：
Benchmark定义:
```pawn
#define Benchmark(%0,%1) \
    static _i;\
    for(new _t = GetTickCount(), _c; _t; ) \
        if(_t != GetTickCount()) \
            for(_i = _t = GetTickCount(); _t; _i = GetTickCount()) \
                if((_i - _t) == (%0)) \
                    for(_t = GetTickCount(); _t; ) \
                        if(_t != GetTickCount()) \
                            for(_i = _t = GetTickCount(); ; ++_c, _i = GetTickCount()) \
                                if((_i - _t) == (%0)) { \
                                    printf(" 执行性能测试:"%1", 平均执行 %.2f 次/毫秒.", floatdiv(_c, (%0))); \
                                    _t = 0; \
                                    break; \
                                } else
```
开始测试
```pawn
//在Benchmark花括号内放入你需要测试的代码/函数
Benchmark(1000, "TestA")
{
    Test();
}
```
输出测试结果
```
执行性能测试:TestA, 平均执行 1191.30 次/毫秒.
```
